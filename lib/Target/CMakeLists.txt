set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_LIST_DIR}/cmake)

# Get all subdirectory
file(GLOB TARGET_DIRS_GLOB RELATIVE ${CMAKE_CURRENT_LIST_DIR} *)
foreach(TARGET_DIR IN LISTS TARGET_DIRS_GLOB)
    if(IS_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}/${TARGET_DIR})
        # Check target list
        set(TARGET_DIRS ${TARGET_DIRS} ${TARGET_DIR})
        string(TOUPPER ${TARGET_DIR} TARGET_DIR)
        set(TARGET_DIRS_UPPER ${TARGET_DIRS_UPPER} ${TARGET_DIR})
    endif(IS_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}/${TARGET_DIR})
endforeach(TARGET_DIR IN LISTS TARGET_DIRS_GLOB)

set(TARGET_LIBRARIES "")
foreach(ONNC_TARGET IN LISTS ONNC_TARGETS)
    # Get target name
    string(LENGTH ${ONNC_TARGET} EACH_LEN)
    math(EXPR SUBSTR_LEN "${EACH_LEN} - 14")
    string(SUBSTRING ${ONNC_TARGET} 7 ${SUBSTR_LEN} ONNC_TARGET_NAME)
    # Find target
    string(TOUPPER ${ONNC_TARGET_NAME} ONNC_TARGET_UPPER)
    list(FIND TARGET_DIRS_UPPER ${ONNC_TARGET_UPPER} TAEGET_EXIST)
    # Set target if exist
    if(TAEGET_EXIST GREATER -1)
        option(${ONNC_TARGET} "Enable ${ONNC_TARGET_NAME} target in onnc" ON)
        list(GET TARGET_DIRS ${TAEGET_EXIST} TARGET_DIR_NAME)
        # Add subdirectory
        if(${ONNC_TARGET})
            add_subdirectory(${TARGET_DIR_NAME})
            set(obj_name "onnc_${TARGET_DIR_NAME}_obj")
            set(TARGET_NAMES ${TARGET_NAMES} ${TARGET_DIR_NAME})
            set(TARGET_OBJS ${TARGET_OBJS} ${${obj_name}})
        endif(${ONNC_TARGET})
    endif(TAEGET_EXIST GREATER -1)
endforeach(ONNC_TARGET IN LISTS ONNC_TARGETS)

set(ONNC_TARGET_NAMES ${TARGET_NAMES} PARENT_SCOPE)
set(ONNC_TARGET_OBJS ${TARGET_OBJS} PARENT_SCOPE)